.MICOM_HARWARE_CONFIGURATION

# 임베디드 마이크로 컴퓨터 구성

임베디드 시스템의 하드웨어에서 공통된 부분을 소개하고, 임베디드 시스템에서 소프트웨어를 동작시키기 위한 필요 지식에 대해 설명한다

## 하드웨어의 종류
* CPU
  * Bus를 통해서 명령을 전달하고 입력을 전달 받는다. 
* Memory
  * ROM (Read Only Memory) 
  * RAM (Random Access Memory) 
* Peripheral(주변장치)

### 메모리의 종류

**(1) ROM (Read Only Memory)**

프로그램을 보관해 두고, CPU가 참조하여 동작을 수행한다. 제조공정에서 데이터를 써놓으면 바꿀 수 없는 MaskROM, 작성이 가능한 ProgrammableROM으로 나뉜다.

* ROM
  * MaskROM (명령코드, 상수 저장)
    * 제조공정에 데이터가 써지며, 삭제 불가함. 저렴
  * FlashMemory (명령코드, 상수 저장)
    * 전기적으로 저장하며, 재기록 가능하다. 
  * EEPROM (명령코드, 상수 저장)
    * 바이트 단위로 삭제 가능하며, 용량이 적다.
  * EPROM (명령코드, 상수)
    * 자외선을 통한 저장, 재기록 가능
  * PROM (OTP) 
    * 삭제 불가로 1회의 재기록 가능

**(2) RAM (Random Access Memory)**

데이터 보관과 무관한 기능을 전환할 때 사용되며, DynamicRAM (DRAM), StaticRAM(SRAM) 두 종류가 있다.

* RAM
  * SRAM 
    * 전기적으로 기록,삭제하며 소비전류가 적다.
  * DRAM
    * 프로그램처리, 고밀도

### 버스의 구성

메인버스와 로컬버스로 나뉘며, 메모리 등의 고속 제어장치는 메인버스를 통해 CPU와 접속하며, 이외의 주변장치는 Bridge를 경유하여 CPU와 통신함.

**메인버스**

각종 버스 신호는 Clock(신호)에 의해 동기화되어 디바이스(메모리, 주변장치)에 지시를 전달하는데에 사용된다.

(1) 주소 버스 : 특정 디바이스에 접근하기 위해 이용하는 신호

(2) 데이터 버스 : 디바이스로부터 데이터를 읽어들이기 위한 신호

(3) 컨트롤 버스 : 디바이스 제어를 위한 신호선

</br>

**로컬버스**

메인버스의 클럭 속도보다 저속으로 동작하는 디바이스를 제어하는 신호선

(1) 브릿지 

메인버스와 로컬버스를 연결하는 컨트롤러, FIFO룰 구현한 하드웨어 등에서, 저속의 로컬버스와 메인 버스 타이밍에 맞춰서 데이터를 송수신해주는 하드웨어

(2) UART

동기식 직렬신호를 병렬신호로, 혹은 역으로 변환하는 하드웨어. CPU로부터 8~16비트 폭으로 데이터가 병렬 전송되며, 이를 직렬 신호로 (Tx) 전송한다. 수신(Rx)에는 병렬로 변환 후에 송신한다.

UART 끼리 통신시에는 데이터의 시작과 긑을 데이터 사이에 신호로 보내어 송수신을 하며, 호스트 PC와 임베디드 시스템에 접속하여 시리얼 콘솔로 테스트나 디버깅할때 많이 사용된다.

(3) I2C

Serial Clock(SCL)과 Serial Data(SDA) 두개의 신호선을 사용하여 통신하는 동기식 직렬 통신. 마스터와 슬레이브가 있어서 복수 슬레이브에 연결이 가능하다. bit rate (초당 전송 비트수)는 표준(100Kbit/s), 저속(400Kbit/s), 고속(3.4Mbit/s)가 있다.

    **동기식/비동기식**

    동기와 비동기를 나누는 가장 큰 차이점을 어떻게 실행 순서를 가지는 지에 있다.

    Syncronous 동기는 요청을 보낸 후 해당 요청의 응답을 받아야 다음 동작을 실행하는 방식을,

    Asynchronous 비동기는 요청을 보낸 후 응답과 관계없이 다음 동작을 실행할 수 있는 방식을 의미한다.


(4) SPI

시리얼 커뮤니케이션을 하며, Serial Clock과 단방향 Seiral Data In (SDI), Serial Data Out (SDO)로 통신하는 동기식 직렬 통신. 복수의 슬레이브에 접속 가능하며, Slave Select를 이용하여 Slave 선택하여 통신. 많은 신호선이 필요하지만 I2C보다 빠르다.


### Peripheral (주변장치)

(1) DMA (Direct Memory Access) Controller

CPU가 PIO(Programmed I/O)를 통해 메모리를 읽고 쓸수있지만, 자원관리를 위해서 DMA를 통해 CPU를 사용하지 않고 데이터를 읽고 쓴다. Bus Aribiter를 이용해서 데이터 충돌이 없이 DMA 가 데이터 처리를 하도록 돕는다.

> 데이터 전송 도중에 버스를 점유하여 메모리 엑세스가 늦어질 수 있으므로, 전송 설정 (주소, 사이즈)를 잘 설정해야한다.

(2) Timer

Peripheral의 지속적인 감시 혹은 주기적 데이터 출력을 위한 시간 관련 처리에서 필수적이다. 카운터라고 불리는 레지스터에 주기 시간을 설정하고, 시간 경과하면 Interrupt발생. CPU는 해당 인터럽트를 통해서 프로그램을 동작시켜 주기적 처리를 실현함.

(3) RTC (Real Time Clock)

시간관리 장치. CPU 정지후 재개시 정확한 시간을 제공

(4) GPIO (General Perpose Input/Output)

CPU에 직접 연결되어 입력 및 출력을 범용으로 사용되는 포트. 외부의 주변장치로부터 인터럽트 신호에 사용되는 등 범용적으로 IO에 이용 가능하다.

### 제어방식

대다수 CPU의 Resigster라는 제어용 메모리를 사용해서 제어함. CPU 관점에서 레지스터 제어는 Memory mapped I/O와 I/O mapped I/O가 있다.

https://code-lab1.tistory.com/204

* Memory Mapped I/O : 

  ROM, RAM과 공통 주소를 이용하여 특정 주소에 대해 읽고 씀. ROM,RAM과 마찬가지로 주변장치의 레지스터도 메모리로 취급함.

* I/O Mapped I/O

  I/O 맵드 I/O의 경우, ROM, RAM는 메모리 공간으로 취급하고, 주변장치의 레지스터는 전용 명령으로 제어한다.
